<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Applications - JOBSEEK</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/0e035b9984.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='webpage/css/main.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        /* ... existing styles ... */
        .profile-btn {
            padding: 5px 10px;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            margin-left: 10px;
        }

        .profile-btn:hover {
            background-color: #0056b3;
        }

        /* Add some basic styling for the filter sidebar */
        .sidebar {
            background-color: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #dee2e6;
        }

        .filter-section {
            margin-bottom: 20px;
        }

        /* Add this style to make the sidebar fixed */
        .sidebar {
            position: fixed;
            /* Make the sidebar fixed */
            top: 0;
            /* Align to the top */
            left: 0;
            /* Align to the left */
            height: 100%;
            /* Full height */
            overflow-y: auto;
            /* Enable scrolling if content overflows */
            z-index: 1000;
            /* Ensure it stays above other content */
        }

        .main {
            margin-top: 0%;
            margin-left: 350px;
            /* Adjust margin to prevent overlap */
        }
    </style>
</head>

<body>
    {% include 'recruiter/_navbar.html' %}
    <div class="main">
        <div class="container-fluid">
            <div class="row">
                <!-- Filter Sidebar -->
                <div class="col-md-3 sidebar">
                    <h4>Filters</h4>
                    <form id="filterForm">
                        <div class="filter-section">
                            <h5>Technical Skills</h5>
                            {% for skill in technical_skills %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="technical_skills"
                                    value="{{ skill }}" id="tech_{{ skill }}">
                                <label class="form-check-label" for="tech_{{ skill }}">{{ skill }}</label>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="filter-section">
                            <h5>Soft Skills</h5>
                            {% for skill in soft_skills %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="soft_skills" value="{{ skill }}"
                                    id="soft_{{ skill }}">
                                <label class="form-check-label" for="soft_{{ skill }}">{{ skill }}</label>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="filter-section">
                            <h5>Experience</h5>
                            <select class="form-select" name="experience">
                                <option value="">All</option>
                                <option value="0-2">0-2 years</option>
                                <option value="3-5">3-5 years</option>
                                <option value="5+">5+ years</option>
                            </select>
                        </div>
                        <div class="filter-section">
                            <h5>Education</h5>
                            <select class="form-select" name="education">
                                <option value="">All</option>
                                {% for edu in education_levels %}
                                <option value="{{ edu }}">{{ edu }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Apply Filters</button>
                        <button type="button" class="btn btn-secondary" id="clearFilters">Clear Filters</button>
                    </form>

                </div>

                <!-- Main Content -->
                <div class="col-md-9">
                    <h2 class="mb-4">Job Applications for: {{ job.title }}</h2>
                    <div id="applicationsContainer">
                        {% if app %}
                        {% for application in app %}
                        <div class="card mb-3">
                            <div class="card-body">
                                <h5 class="card-title d-flex align-items-center">
                                    Applicant: {{ application.applicant_name }}
                                    <a href="{{ url_for('recruiter.view_applicant_profile', applicant_id=application.user_id, job_id=job._id) }}"
                                        class="profile-btn" title="View Profile">
                                        <i class="fas fa-user-circle"></i>
                                    </a>
                                </h5>
                                <p class="card-text">
                                    <strong>Email:</strong> {{ application.applicant_email }}<br>
                                    <strong>Applied on:</strong> {{ application.applied_at }}<br>
                                    <strong>Status:</strong> {{ application.status }}
                                </p>
                                <a href="{{ url_for('recruiter.view_applications', job_id=job._id) }}"
                                    class="btn btn-primary">Refresh</a>
                                <button class="btn shortlist-btn" data-application-id="{{ application.id }}">
                                    {% if application.status == 'shortlisted' %}
                                    Unshortlist
                                    {% else %}
                                    Shortlist
                                    {% endif %}
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <p>No applications found for this job.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <footer>
        <div class="container text-center text-md-start">
            <div class="footer-wrap">
                <div class="about">
                    <img src="./img/icon/company-logo.svg" alt="">
                    <p class="text-muted py-4">
                        Start working with Firmbee which can provide you with all the tools needed to run an effcieint
                        business
                        remotely.
                    </p>
                    <div class="social-media">
                        <a href="" class="me-2 text-reset"><img src="img/icon/facebook-icon.svg" alt=""></a>
                        <a href="" class="me-2 text-reset"><img src="img/icon/twitter-icon.svg" alt=""></a>
                        <a href="" class="me-2 text-reset"><img src="img/icon/linkedin-icon.svg" alt=""></a>
                        <a href="" class="me-2 text-reset"><img src="img/icon/instagram-icon.svg" alt=""></a>
                    </div>
                </div>
                <div class="company">
                    <h6 class="fw-bold">Company</h6>
                    <p><a href="">About us</a></p>
                    <p><a href="">Services</a></p>
                    <p><a href="">Team</a></p>
                    <p><a href="">Pricing</a></p>
                    <p><a href="">Project</a></p>
                    <p><a href="">Careers</a></p>
                    <p><a href="">Blog</a></p>
                    <p><a href="">Login</a></p>
                </div>
                <div class="useful-links">
                    <h6 class="fw-bold">Useful links</h6>
                    <p><a href="">Terms of </a></p>
                    <p><a href="">Services</a></p>
                    <p><a href="">Privacy Policy</a></p>
                    <p><a href="">Documentation</a></p>
                    <p><a href="">Changelog</a></p>
                    <p><a href="">Components</a></p>
                </div>
                <div class="newsletter">
                    <h6 class="fw-bold">Newsletter</h6>
                    <p class="text-muted">Sign up and receive the latest tips
                        via email.</p>
                    <form id="subscribe" action="">
                        <label for="email">Your e-mail:</label>
                        <input type="email" placeholder="e-mail:" name="email" required>
                        <button type="submit" class="main-btn">Subscribe</button>
                    </form>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2024 JOBSEEK</p>
                <!--
              This template is licenced under Attribution 3.0 (CC BY 3.0 PL),
              You are free to: Share and Adapt. You must give appropriate credit, you may do so in any reasonable manner, but not in any way that suggests the licensor endorses you or your use.
              -->
            </div>
        </div>
    </footer>
    <div class="fb2022-copy">Fbee 2022 copyright</div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Add this to your HTML, perhaps at the end of the body -->
    <div class="modal fade" id="shortlistModal" tabindex="-1" aria-labelledby="shortlistModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="shortlistModalLabel">Confirm Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to <span id="shortlistAction"></span> this candidate?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmShortlist">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let currentApplicationId, currentJobId, currentButton;

        // Update this event listener for the shortlist buttons
        $(document).on('click', '.shortlist-btn', function () {
            currentApplicationId = $(this).data('application-id');
            currentJobId = "{{ job._id }}";
            currentButton = $(this);

            const action = currentButton.text().trim() === 'Shortlist' ? 'shortlist' : 'unshortlist';
            $('#shortlistAction').text(action);
            $('#shortlistModal').modal('show');
        });

        // Add this new event listener for the confirm button in the modal
        $('#confirmShortlist').on('click', function () {
            $.ajax({
                url: `/recruiter/toggle_shortlist/${currentApplicationId}`,
                type: 'POST',
                data: { job_id: currentJobId },
                success: function (response) {
                    if (response.success) {
                        if (response.shortlisted) {
                            currentButton.text('Unshortlist');
                            currentButton.closest('.card-body').find('strong:contains("Status")').next().text('shortlisted');
                        } else {
                            currentButton.text('Shortlist');
                            currentButton.closest('.card-body').find('strong:contains("Status")').next().text('applied');
                        }
                        $('#shortlistModal').modal('hide');
                    } else {
                        alert('Failed to update shortlist status');
                    }
                },
                error: function () {
                    alert('An error occurred while updating shortlist status');
                }
            });
        });

        $('#filterForm').on('submit', function (event) {
            event.preventDefault();
            const formData = $(this).serialize();
            const jobId = "{{ job._id }}";

            $.get(`/recruiter/view_applications/${jobId}`, formData, function (data) {
                $('#applicationsContainer').html(data);
            });
        });
    </script>
    <script>
        // Clear filters functionality
        document.getElementById('clearFilters').addEventListener('click', function () {
            // Reset the form
            document.getElementById('filterForm').reset();
            $.get(`/recruiter/view_applications/${jobId}`, formData, function (data) {
                $('#applicationsContainer').html(data);
            });
        });
    </script>
</body>

</html>